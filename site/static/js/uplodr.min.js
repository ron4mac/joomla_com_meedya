'use strict';(function(n,T){function U(b,a){let c=this;c.show=k=>{c.pb.style.width=100*k+"%";1===k&&(c.pb.className="indeterm")};c.msg=(k,p)=>{c.pbi.innerHTML+="<br />"+k;p&&(c.pbi.className="pbfinf "+e.failcss,C++)};c.rmov=()=>{c.pbw._ufo=null;D.removeChild(c.pbw);c.fObj=null};let f=q("div","",{class:"pbwrp"});c.pb=f.appendChild(q("div","",{class:a}));c.pbi=f.appendChild(q("div",b.fn+'<i class="fa fa-window-close abortX" aria-hidden="true" onclick="this.parentNode.parentNode._ufo.abort(true);"></i>',
{class:"pbfinf"}));D.prepend(f);c.pbw=f;c.pbw._ufo=b;c.fObj=b;return c}function V(b){let a=this;a.upFile=b;a.fn=b.fileName||b.name;a.size=b.fileSize||b.size;a.fType=b.fileType||b.type;a.date=b.lastModified;a.upState="";a.doChnk=a.size>O;a.chnkSize=O;a.relPath=b.webkitRelativePath||a.fn;a.uniqueId=a.size+"-"+Math.random().toString().replace("0.","");a.actSize=a.startByte=a.lastsz=a.chnkNum=0;a.numChnks=Math.ceil(a.size/a.chnkSize);a.fData=a.pBar=null;a.palod=e.payload();a.upForm={task:"ManRaw.upfile",
[Joomla.getOptions("csrf.token")]:1};a.X=new XMLHttpRequest;const c=d=>{if(a.X){if(d){let l=new CustomEvent("mdya.totp",{detail:a.X.response});P.dispatchEvent(l)}a.X.upload.onprogress=null;a.X.onabort=null;a.X.onerror=null;a.X.onload=null;a.X=null}a.fData=null;d&&a.pBar&&(a.pBar.rmov(),a.pBar=null);u(!0,"ufo")},f=(d=!0)=>{a.fData=new FormData;m(a.fData,a.upForm);d&&m(a.fData,a.palod)},k=()=>{f();switch(a.upState){case "":m(a.fData,{type:a.fType,size:a.size,lastMod:a.date});a.fData.set("Filedata",
a.upFile);a.upState="upld";break;case "upld":c(!0);return}a.X.open("POST",e.upURL);a.X.send(a.fData)},p=()=>{f(!1);switch(a.upState){case "":m(a.fData,{chunkact:"pref",file:a.fn,type:a.fType,size:a.size,ident:a.uniqueId});a.upState="chnk";break;case "chnk":m(a.fData,{chunkact:"chnk",ident:a.uniqueId,tchnk:a.numChnks});if(a.chnkNum==a.numChnks){c(!0);return}a.startByte=a.chnkNum*a.chnkSize;let d=Math.min(a.size,a.startByte+a.chnkSize);a.actSize=d-a.startByte;a.fData.set("chnkn",++a.chnkNum);a.chnkNum==
a.numChnks&&(m(a.fData,{fname:a.fn,type:a.fType,size:a.size,lastMod:a.date}),m(a.fData,a.palod));a.fData.set("Filedata",a.upFile[Q](a.startByte,d));a.lastsz=0;break;case "abrt":a.X.timeout=1E4;m(a.fData,{chunkact:"abrt",ident:a.uniqueId});a.upState="nil";break;case "nil":c();return}a.X.open("POST",e.upURL);a.X.send(a.fData)},r={prog:d=>{if(d.lengthComputable){var l=Math.round(d.loaded/d.total*a.actSize);"chnk"==a.upState&&a.chnkNum?(a.pBar.show((a.startByte+l)/a.size),E(l-a.lastsz),a.lastsz=l):"upld"==
a.upState&&(a.pBar.show(d.loaded/d.total),l=Math.round(d.loaded/d.total*a.size),E(l-a.lastsz),a.lastsz=l)}},load:d=>{400<=d.target.status?(403==d.target.status&&R.stop(),a.pBar.msg(d.target.response,!0),a.X=null,u(!0,"errM")):a.doChnk?p():k()},abrt:()=>{a.pBar.msg("-- Aborted",!0);a.doChnk?(a.upState="abrt",p()):c()},fail:()=>{a.pBar.msg(a.X.responseText,!0);c()}};a.abort=()=>{if(a.X){let d=a.X.readyState;4>d&&0!==d?a.X.abort():r.abrt()}else a.pBar.rmov(),a.pBar=null};a.pBar=new U(a,a.doChnk?"chnkpb":
"normpb");b="";if(a.fType.match(new RegExp(e.mimatch)))if("object"==typeof F&&F.length){let d=a.fn.split(".");if(1==d.length||0>F.indexOf(d.pop().toLowerCase()))b="<i class=\"fa fa-info-circle infoG\" onclick=\"alert('Allowed file types: ' + H5uOpts.allowed_file_types.join(', '));\"></i> File type not allowed"}else a.size>e.maxfilesize&&(b="File is larger than allowed");else b="File type is not allowed";if(b)E(a.size),a.pBar.msg(b,!0),a.X=null,u(!0,"errM");else return b=d=>{switch(d.type){case "loadend":200==
d.target.status?a.doChnk?p():k():a.pBar.msg(d.target.responseText,!0)}},a.X.addEventListener("loadstart",b),a.X.addEventListener("error",b),a.X.addEventListener("abort",b),a.X.onload=r.load,a.X.upload.onerror=r.fail,a.X.onerror=r.fail,a.X.upload.onabort=r.abrt,a.X.upload.onprogress=r.prog,a.doChnk?p():k(),a}const g=b=>document.getElementById(b),z=(b,a,c)=>b.addEventListener(a,c,!1);let e=Object.assign({},{lodrdiv:"uplodr",upURL:"upload.php",payload:()=>({}),maxFilesize:134217728,dropMessage:"Drop files here to upload<br>(or click to select)",
acptmime:'accept="image/*" ',mimatch:"image/|video/",failcss:"failure",concurrent:3,maxchunksize:16777216,allowed_file_types:[],success:b=>{},doneFunc:(b,a)=>{}},T),G,D,A,P,h=[],B=e.concurrent,F=e.allowed_file_types,O=e.maxchunksize,v=!1,H=0,w=0,I=0,J=0,K=0,L=0,C=0,t,x,y,Q="",R={stop:function(){v=!0;t.disabled=!0;x.disabled=!1;y.disabled=!1},go:function(){v=!1;t.disabled=!1;x.disabled=!0;for(y.disabled=!1;h.length&&w<B;)u(!1,"go")},cancel:function(){h.length=0;v=!1;t.disabled=!0;x.disabled=!0;y.disabled=
!0;A.innerHTML=0;w||S()}},q=(b,a,c)=>{b=document.createElement(b);a&&(b.innerHTML=a);for(let f in c)b.setAttribute(f,c[f]);return b},M=b=>{b.stopPropagation();b.preventDefault();b.target.className="dragover"==b.type?"hover":"dropzone"},N=b=>{let a,c;b instanceof FileList||(M(b),b=b.target.files||b.dataTransfer.files);K&&(K=H=I=J=0);H+=b.length;for(a=0;c=b[a];a++)I+=c.size,h.push(c),A.innerHTML=h.length,u(!1,"fsel");h.length>B&&(t.disabled=!1)},S=()=>{if(!v||!h.length){K=1;if("function"==typeof e.doneFunc){let b=
L,a=C;setTimeout(()=>e.doneFunc(b,a),1E3)}C=L=0}},u=(b,a)=>{b&&("ufo"==a&&L++,--H?w--:S());!v&&h.length&&(!B||w<B)&&(b=h.shift(),w++,new V(b),A.innerHTML=h.length);0>=h.length&&(t.disabled=!0,x.disabled=!0,y.disabled=!0)},E=b=>{!G||0>b||(J+=b,G.style.width=100*J/I+"%")},m=(b,a)=>{for(let c in a)b.set(c,a[c])};n.H5uSetup=b=>{e=Object.assign({},e,b);b=g(e.lodrdiv);n.File&&n.FileList?(b.appendChild(q("div",'<input type="file" name="userpictures" id="file_field" multiple="multiple"'+e.acptmime+' style="display:none" /><div class="drpmsg">'+
e.dropMessage+"</div>",{id:"dropArea",onclick:"this.firstElementChild.click();"})),b.appendChild(q("div",'<div id="progress_report_name"></div><div id="progress_report_status" style="font-style: italic;"></div><div id="totprogress"><div id="progress_report_bar"></div></div><div class="quebar"><div class="acti">Files queued: <span id="qcount">0</span></div><div class="acti"><button id="qstop" class="btn btn-qaction btn-sm" title="stop queue" onclick="H5uQctrl.stop()" disabled><i class="fa fa-pause-circle pausQ"></i> Pause Queue</button><button id="qresume" class="btn btn-qaction btn-sm" title="resume queue" onclick="H5uQctrl.go()" disabled><i class="fa fa-play-circle playQ"></i> Resume Queue</button><button id="qcancel" class="btn btn-qaction btn-sm" title="cancel queue" onclick="H5uQctrl.cancel()" disabled><i class="fa fa-times cancelQ"></i> Cancel Queue</button></div></div><div id="fprogress"></div><div id="server_response"></div>',
{id:"progress_report",style:"position:relative"})),A=g("qcount"),t=g("qstop"),x=g("qresume"),y=g("qcancel"),P=g(e.fdonetarget),z(g("file_field"),"change",N),(new XMLHttpRequest).upload&&(b=g("dropArea"),z(b,"dragover",M),z(b,"dragleave",M),z(b,"drop",N),b.style.display="block",G=g("progress_report_bar"),D=g("fprogress")),"undefined"!==typeof Blob&&(Q=Blob.prototype.slice?"slice":Blob.prototype.webkitSlice?"webkitSlice":Blob.prototype.mozSlice?"mozSlice":"")):b.appendChild(q("div","Can not use this upload method with the web browser that you are using.",
{}))};n.H5uQctrl=R;n.H5uOpts=e;n.fupQadd2=N})(window,Joomla.getOptions("H5uOpts"));