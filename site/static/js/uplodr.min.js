'use strict';function $id(f){return document.getElementById(f)}function $ae(f,M,A){f.addEventListener(M,A,!1)}
(function(f,M,A){function R(b,a){let c=this;c.show=k=>{c.pb.style.width=100*k+"%";1===k&&(c.pb.className="indeterm")};c.msg=(k,m)=>{c.pbi.innerHTML+="<br />"+k;m&&(c.pbi.className="pbfinf "+e.failcss,B++)};c.rmov=()=>{c.pbw._ufo=null;C.removeChild(c.pbw);c.fObj=null};let g=n("div","",{class:"pbwrp"});c.pb=g.appendChild(n("div","",{class:a}));c.pbi=g.appendChild(n("div",b.fn+'<i class="fa fa-window-close abortX" aria-hidden="true" onclick="this.parentNode.parentNode._ufo.abort(true);"></i>',{class:"pbfinf"}));
C.appendChild(g);c.pbw=g;c.pbw._ufo=b;c.fObj=b;return c}function S(b){let a=this;a.upFile=b;a.fn=b.fileName||b.name;a.size=b.fileSize||b.size;a.fType=b.fileType||b.type;a.date=b.lastModified;a.upState="";a.doChnk=a.size>N;a.chnkSize=Math.round(N/2)-3072;a.relPath=b.webkitRelativePath||a.fn;a.uniqueId=a.size+"-"+Math.random().toString().replace("0.","");a.actSize=a.startByte=a.lastsz=a.chnkNum=0;a.numChnks=Math.max(Math.floor(a.size/a.chnkSize),1);a.fData=a.pBar=null;a.palod=e.payload();a.upForm={};
a.X=new XMLHttpRequest;const c=d=>{a.X&&(a.X.upload.onprogress=null,a.X.onabort=null,a.X.onerror=null,a.X.onload=null,a.X=null);a.fData=null;d&&a.pBar&&(a.pBar.rmov(),a.pBar=null);t(!0,"ufo")},g=(d=!0)=>{a.fData=new FormData;l(a.fData,a.upForm);d&&l(a.fData,a.palod)},k=()=>{g();switch(a.upState){case "":l(a.fData,{type:a.fType,size:a.size,lastMod:a.date});a.fData.append("Filedata",a.upFile);a.upState="upld";break;case "upld":c(!0);return}a.X.open("POST",e.upURL);a.X.send(a.fData)},m=()=>{g(!1);switch(a.upState){case "":l(a.fData,
{chunkact:"pref",file:a.fileName,type:a.fType,size:a.size,ident:a.uniqueId});a.upState="chnk";break;case "chnk":l(a.fData,{chunkact:"chnk",ident:a.uniqueId,tchnk:a.numChnks});if(a.chnkNum==a.numChnks){c(!0);return}a.startByte=a.chnkNum*a.chnkSize;a.endByte=Math.min(a.size,(a.chnkNum+1)*a.chnkSize);a.size-a.endByte<a.chnkSize&&(a.endByte=a.size);a.actSize=a.endByte-a.startByte;a.fData.append("chnkn",++a.chnkNum);a.chnkNum==a.numChnks&&(l(a.fData,{fname:a.fileName,type:a.fType,size:a.size,lastMod:a.date}),
l(a.fData,a.palod));a.fData.append("Filedata",a.upFile[O](a.startByte,a.endByte));a.lastsz=0;break;case "abrt":a.X.timeout=1E4;l(a.fData,{chunkact:"abrt",ident:a.uniqueId});a.upState="nil";break;case "nil":c();return}a.X.open("POST",e.upURL);a.X.send(a.fData)},q={prog:d=>{if(d.lengthComputable){var p=Math.round(d.loaded/d.total*a.actSize);"chnk"==a.upState&&a.chnkNum?(a.pBar.show((a.startByte+p)/a.size),D(p-a.lastsz),a.lastsz=p):"upld"==a.upState&&(a.pBar.show(d.loaded/d.total),p=Math.round(d.loaded/
d.total*a.size),D(p-a.lastsz),a.lastsz=p)}},load:d=>{console.log("QQQ",d);400<=d.target.status?(403==d.target.status&&P.stop(),a.pBar.msg(d.target.response,!0),a.X=null,t(!0,"errM")):a.doChnk?m():k()},abrt:()=>{a.pBar.msg("-- Aborted",!0);a.doChnk?(a.upState="abrt",m()):c()},fail:()=>{a.pBar.msg(a.X.responseText,!0);c()}};a.abort=()=>{if(a.X){let d=a.X.readyState;4>d&&0!==d?a.X.abort():q.abrt()}else a.pBar.rmov(),a.pBar=null};a.pBar=new R(a,a.doChnk?"chnkpb":"normpb");b="";if(a.fType.match(/image\/|video\//))if("object"==
typeof E&&E.length){let d=a.fn.split(".");if(1==d.length||0>E.indexOf(d.pop().toLowerCase()))b="<i class=\"fa fa-info-circle infoG\" onclick=\"alert('Allowed file types: ' + H5uOpts.allowed_file_types.join(', '));\"></i> File type not allowed"}else a.size>e.maxfilesize&&(b="File is larger than allowed");else b="File type is not allowed";if(b)D(a.size),a.pBar.msg(b,!0),a.X=null,t(!0,"errM");else return b=d=>{console.log(`${d.type}: ${d.loaded} bytes transferred\n`,d);switch(d.type){case "loadend":200==
d.target.status?a.doChnk?m():k():a.pBar.msg(d.target.responseText,!0)}},a.X.addEventListener("loadstart",b),a.X.addEventListener("progress",b),a.X.addEventListener("error",b),a.X.addEventListener("abort",b),a.X.onload=q.load,a.X.upload.onerror=q.fail,a.X.onerror=q.fail,a.X.upload.onabort=q.abrt,a.X.upload.onprogress=q.prog,a.doChnk?m():k(),a}var e=Object.assign({},{lodrdiv:"uplodr",upURL:"upload.php",payload:()=>({}),maxFilesize:134217728,dropMessage:"Drop files here to upload<br>(or click to select)",
failcss:"failure",concurrent:3,maxchunksize:16777216,allowed_file_types:[],success:b=>{},doneFunc:(b,a)=>{}},A),F,C,y,h=[],z=e.concurrent,E=e.allowed_file_types,N=e.maxchunksize,u=!1,v=0,G=0,H=0,I=0,J=0,B=0,r,w,x,O="",P={stop:function(){u=!0;r.disabled=!0;w.disabled=!1;x.disabled=!1},go:function(){u=!1;r.disabled=!1;w.disabled=!0;for(x.disabled=!1;h.length&&v<z;)t(!1,"go")},cancel:function(){h.length=0;u=!1;r.disabled=!0;w.disabled=!0;x.disabled=!0;y.innerHTML=0;v||Q()}};let n=(b,a,c)=>{b=document.createElement(b);
a&&(b.innerHTML=a);for(let g in c)b.setAttribute(g,c[g]);return b},K=b=>{b.stopPropagation();b.preventDefault();b.target.className="dragover"==b.type?"hover":"dropzone"},L=b=>{let a,c;b instanceof FileList||(K(b),b=b.target.files||b.dataTransfer.files);I&&(I=G=H=0);for(a=0;c=b[a];a++)G+=c.size,h.push(c),y.innerHTML=h.length,t(!1,"fsel");h.length>z&&(r.disabled=!1)},Q=()=>{console.log("ENDUP");if(!u||!h.length){I=1;if("function"==typeof e.doneFunc){let b=J,a=B;setTimeout(()=>e.doneFunc(b,a),1E3)}B=
J=0}},t=(b,a)=>{b&&("ufo"==a&&J++,--v||Q());!u&&h.length&&(!z||v<z)&&(b=h.shift(),new S(b),v++,y.innerHTML=h.length);0>=h.length&&(r.disabled=!0,w.disabled=!0,x.disabled=!0)},D=b=>{!F||0>b||(H+=b,F.style.width=100*H/G+"%")},l=(b,a)=>{for(let c in a)b.append(c,a[c])};f.H5uSetup=b=>{e=Object.assign({},e,b);b=$id(e.lodrdiv);f.File&&f.FileList?(b.appendChild(n("div",'<input type="file" name="userpictures" id="file_field" multiple="multiple" accept="image/*,video/*" style="display:none"><div class="drpmsg">'+
e.dropMessage+"</div>",{id:"dropArea",onclick:"$id('file_field').click();"})),b.appendChild(n("div",'<div id="progress_report_name"></div><div id="progress_report_status" style="font-style: italic;"></div><div id="totprogress"><div id="progress_report_bar"></div></div><div class="quebar"><div class="acti">Files queued: <span id="qcount">0</span></div><div class="acti"><button id="qstop" class="btn btn-secondary btn-sm" title="stop queue" onclick="H5uQctrl.stop()" disabled><i class="fa fa-pause-circle pausQ"></i> Pause Queue</button><button id="qresume" class="btn btn-secondary btn-sm" title="resume queue" onclick="H5uQctrl.go()" disabled><i class="fa fa-play-circle playQ"></i> Resume Queue</button><button id="qcancel" class="btn btn-secondary btn-sm" title="cancel queue" onclick="H5uQctrl.cancel()" disabled><i class="fa fa-times cancelQ"></i> Cancel Queue</button></div></div><div id="fprogress"></div><div id="server_response"></div>',
{id:"progress_report",style:"position:relative"})),y=$id("qcount"),r=$id("qstop"),w=$id("qresume"),x=$id("qcancel"),$ae($id("file_field"),"change",L),(new XMLHttpRequest).upload&&(b=$id("dropArea"),$ae(b,"dragover",K),$ae(b,"dragleave",K),$ae(b,"drop",L),b.style.display="block",F=$id("progress_report_bar"),C=$id("fprogress")),"undefined"!==typeof Blob&&(O=Blob.prototype.slice?"slice":Blob.prototype.webkitSlice?"webkitSlice":Blob.prototype.mozSlice?"mozSlice":"")):b.appendChild(n("div","Can not use this upload method with the web browser that you are using.",
{}))};f.H5uQctrl=P;f.H5uOpts=e;f.fupQadd2=L})(window,[],Joomla.getOptions("H5uOpts"));