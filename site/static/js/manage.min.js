/*
	Copyright (C) 2022 RJCreations. All rights reserved.
 @license		GNU General Public License version 3 or later; see LICENSE.txt
*/
'use strict';const _id=m=>document.getElementById(m),_pd=(m,e=!0)=>{m.preventDefault&&m.preventDefault();e&&m.stopPropagation&&m.stopPropagation()},_ae=(m,e,p,k=!1)=>{m.addEventListener(e,p,k)},_T=m=>Joomla.Text._(m);
var Meedya=function(m,e,p){const k=Joomla.getOptions("csrf.token");let g=!1,t=a=>{if(!(0>a.dataTransfer.types.indexOf("imgsrc")))return _pd(a),!1},x=a=>{_pd(a);let c=a.dataTransfer.getData("imgsrc");if(c){let n=a.target.parentElement.getElementsByTagName("IMG")[0];n.src=c;n.style.opacity=null;_id("albthmid").value=a.dataTransfer.getData("meeid")}},w=(a,c=!1)=>{if(document.querySelectorAll(a).length)return!0;c&&bootbox.alert(_T("COM_MEEDYA_SELECT_SOME"));return!1},r=null,u=a=>{e("#alert-dlg span").html(a);
e("#alert-dlg").show()},v=null;return{confirm:(a,c,n,l)=>{e("#"+a+" .modal-title").html(c);e("#"+a+" .modal-body").html(n);r=l;e("#"+a).modal("show")},confirmed:a=>r(a),alert:u,setDlgParAlb:()=>{_id("h5u_palbum")&&(_id("h5u_palbum").value=Meedya.AArrange.selalb())},selAllImg:(a,c)=>{_pd(a);a=c?"checked":"";c=document.adminForm.elements["slctimg[]"];c.length||(c=[c]);for(let n=0;n<c.length;n++)c[n].checked=a},editSelected:a=>{_pd(a);w("input[name='slctimg[]']:checked",!0)&&(document.adminForm.task.value=
"manage.imgsEdit",document.adminForm.submit())},addSelected:a=>{_pd(a);w("input[name='slctimg[]']:checked",!0)&&e("#add2albdlg").modal("show")},removeSelected:a=>{_pd(a);w("[name='slctimg[]']:checked",!0)&&bootbox.confirm({message:_T("COM_MEEDYA_REMOVE"),buttons:{confirm:{label:_T("COM_MEEDYA_VRB_REMOVE"),className:"btn-danger"},cancel:{label:_T("JCANCEL")}},callback:c=>{if(c){c=document.querySelectorAll("[name='slctimg[]']:checked");let n=c[0].parentNode.parentNode;for(let l=0;l<c.length;l++)n.removeChild(c[l].parentNode);
g=!0}}})},deleteSelected:a=>{_pd(a);w("[name='slctimg[]']:checked",!0)&&bootbox.confirm({message:_T("COM_MEEDYA_PERM_DELETE"),buttons:{confirm:{label:_T("JACTION_DELETE"),className:"btn-danger"},cancel:{label:_T("JCANCEL")}},callback:c=>{c&&(document.adminForm.task.value="manage.deleteItems",document.adminForm.submit())}})},setAlbumDanD:()=>{var a=_id("albthm");_ae(a,"dragover",t);_ae(a,"drop",x);_ae(a,"dragenter",c=>{_pd(c);c.target.style.opacity="0.5"});_ae(a,"dragleave",c=>c.target.style.opacity=
null);a=_id("albForm");_ae(a,"dragstart",c=>c.dataTransfer.setData("albthm","X"));_ae(a,"dragover",c=>{0<c.dataTransfer.types.indexOf("albthm")&&(_pd(c),c.dataTransfer.dropEffect="move")});_ae(a,"dragenter",c=>{0<c.dataTransfer.types.indexOf("albthm")&&(_pd(c),c.dataTransfer.dropEffect="move")});_ae(a,"drop",c=>{_pd(c);_id("albthmimg").src="components/com_meedya/static/img/img.png";_id("albthmid").value=0})},saveAlbum:()=>{g&&(document.albForm.thmord.value=Meedya.Arrange.iord());document.albForm.submit()},
watchAlb:a=>{let c=_id("creab");0<a.value?(_id("creanualb").style.display="none",c.disabled=!1):(c.disabled=!0,-1==a.value?_id("creanualb").style.display="block":_id("creanualb").style.display="none")},watchAlbNam:a=>{let c=_id("creab");a.value.trim()?c.disabled=!1:c.disabled=!0},addItems2Album:a=>{a.disabled=!0;document.adminForm.albumid.value=_id("h5u_album").value;document.adminForm.nualbnam.value=_id("nualbnam").value;document.adminForm.nualbpar.value=_id("h5u_palbum").value;document.adminForm.nualbdesc.value=
_id("albdesc").value;document.adminForm.task.value="manage.addItemsToAlbum";document.adminForm.submit()},ae_createAlbum:a=>{a.disabled=!0;a=_id("nualbnam");let c=_id("h5u_palbum"),n=_id("albdesc");a={task:"manage.newAlbum",albnam:a.value.trim(),paralb:c?c.value:0,albdesc:n.value};a[k]=1;e.post(m.rawURL,a).done(l=>{l?u(l):p.location.reload(!0)}).fail(l=>u(l.responseText))},moveItem:(a,c)=>{_pd(a,!0);a=c.parentElement;if(v){v.classList.remove("moving");if(a!=v){c=_id("area");let n=c.removeChild(v);
c.insertBefore(n,a)}v=null}else v=a,a.classList.add("moving")},setVideoThumb:(a,c)=>{_pd(a,!0);a=document.getElementById("my-video-canvas");let n=a.getContext("2d"),l=document.querySelector("#zoom-zvid"),d=document.getElementById("my-vidover"),f=0,b=l.videoWidth,h=l.videoHeight,q=0,y=0,A=d.width,B=d.height;l?(0<c?(q=160,y=Math.min(h/q,b/160),b=Math.round(160*y),h=Math.round(q*y),f=0<l.videoWidth-b?l.videoWidth-b>>1:0):q=Math.round(160/(b/h)),a.width=160,a.height=q,n.drawImage(l,f,0,b,h,0,0,160,q),
n.drawImage(d,0,0,A,B,3,3,A,B),a=a.toDataURL("image/jpeg",.8),c={task:"manage.setVideoThumb",vid:c,imgBase64:a},c[Joomla.getOptions("csrf.token","")]=1,e.post(m.rawURL,c).done(z=>{Meedya.thmelmsrc.src=z;iZoomClose()}).fail(z=>u(z.responseText))):u("Did not locate the video.")},dirtyThumbs:a=>{g=a}}}(Joomla.getOptions("Meedya"),jQuery,window);
Meedya.Arrange=function(m){let e=null,p=!0,k="",g,t=d=>{if(d.target.parentElement.parentElement==e)return!1;d=d.dataTransfer.types;for(let f=0;f<d.length;++f)if("meeid"===d[f])return!0;return!1},x=d=>{e=d.target.parentElement.parentElement;e.style.opacity="0.4";d.dataTransfer.effectAllowed="copyMove";d.dataTransfer.setData("meeid",e.dataset.id);d.dataTransfer.setData("imgsrc",d.target.src)},w=d=>{p=!0;50>d.clientY&&(p=!1,l(-1));d.clientY>m(window).height()-50&&(p=!1,l(1))},r=d=>{if(1==d.targetTouches.length){let f=
d.targetTouches[0];d.target.style.left=f.pageX+"px";d.target.style.top=f.pageY+"px"}},u=d=>{e.style.opacity=null;[].forEach.call(g,f=>f.classList.remove("over"));p=!0},v=d=>{_pd(d);d=d.target.parentElement.parentElement;if(e!=d){let f=_id(k),b=f.removeChild(e);f.insertBefore(b,d);Meedya.dirtyThumbs(!0)}return!1},a=d=>{if(t(d))return _pd(d),d.target.classList.add("over"),!1},c=d=>{if(t(d))return _pd(d),!1},n=d=>{d.target.classList.remove("over")};const l=d=>{let f=m(window).scrollTop();m(window).scrollTop(f+
d);p||setTimeout(()=>l(d),60)};return{init:(d,f)=>{k=d;g=document.querySelectorAll("#"+d+" img");[].forEach.call(g,b=>{_ae(b,"drag",w);_ae(b,"dragstart",x);_ae(b,"dragenter",a);_ae(b,"dragover",c);_ae(b,"dragleave",n);_ae(b,"drop",v);_ae(b,"dragend",u);_ae(b,"touchmove",r)})},iord:()=>{g=document.querySelectorAll("#"+k+" .item");let d=[];[].forEach.call(g,f=>{(f=f.dataset.id)&&d.push(f)});return d.join("|")}}}(jQuery);
Meedya.AArrange=function(m,e){let p=null,k=null,g=!0,t,x=(b,h,q)=>{b={task:"manage.adjustAlbPaid",aid:b,paid:h};b[Joomla.getOptions("csrf.token","")]=1;e.post(m.rawURL,b,y=>q(y))},w=b=>{if(b.target==p)return!1;b=b.dataTransfer.types;for(let h=0;h<b.length;++h)if("meeid"===b[h])return!0;return!1},r=b=>{b.target.style.opacity="0.4";p=b.target;b.dataTransfer.effectAllowed="copyMove";b.dataTransfer.setData("meeid",p.dataset.id);b.target.classList.add("moving")},u=b=>{if(w(b))return _pd(b),!1},v=b=>{if(w(b))return _pd(b),
b.target.classList.add("over"),!1},a=b=>{_pd(b);b.target.classList.remove("over")},c=b=>{_pd(b);p!=b.target&&x(p.dataset.aid,b.target.dataset.aid,h=>{h?bootbox.alert(_T("COM_MEEDYA_MOVE_FAIL")):b.target.append(p)});return!1},n=b=>{p.style.opacity=null;[].forEach.call(t,h=>h.classList.remove("over"));b.target.classList.remove("moving");g=!0},l=b=>{g=!0;50>b.clientY&&(g=!1,f(-1));b.clientY>e(window).height()-50&&(g=!1,f(1))},d=b=>{if(1==b.targetTouches.length){let h=b.targetTouches[0];b.target.style.left=
h.pageX+"px";b.target.style.top=h.pageY+"px"}};const f=b=>{let h=e(window).scrollTop();e(window).scrollTop(h+b);g||setTimeout(()=>f(b),500)};return{init:(b,h)=>{t=document.querySelectorAll("#"+b+" ."+h);[].forEach.call(t,q=>{q.setAttribute("draggable","true");_ae(q,"drag",l);_ae(q,"dragstart",r,!0);_ae(q,"dragenter",v);_ae(q,"dragover",u);_ae(q,"dragleave",a);_ae(q,"drop",c);_ae(q,"dragend",n);_ae(q,"touchmove",d)})},selalb:()=>k?k.dataset.aid:0,iSelect:(b,h=this)=>{_pd(b);k&&k.classList.remove("slctd");
h==k?k=null:(k=h,k.classList.add("slctd"))}}}(Joomla.getOptions("Meedya"),jQuery);
(function(m,e,p){let k,g,t=r=>{r&&_pd(r);document.body.removeChild(k)},x=r=>{switch(r.charCode){case 32:case 13:case 27:t(r)}},w=r=>{switch(r.keyCode){case 32:case 13:case 27:t(r)}};p.iZoomOpen=(r,u)=>{u&&(Meedya.thmelmsrc=u.parentElement.previousElementSibling.firstElementChild);g=document.createElement("div");e.post(m.rawURL,{task:"manage.getZoomItem",iid:r}).done(v=>g.innerHTML=v);g.className="zoom-area";g.tabIndex="-1";k=document.createElement("div");k.className="zoom-back";k.appendChild(g);document.body.appendChild(k);
_ae(g,"keypress",x);_ae(g,"keydown",w);g.focus();_ae(k,"click",t)};p.iZoomClose=t})(Joomla.getOptions("Meedya"),jQuery,window);